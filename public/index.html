<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <script src="assets/js/jquery3.3.1.js"></script>
  <script src="assets/js/authentication.js"></script>
  <title>PWM-Login</title>
</head>

<body>
  <h1>Login</h1>
    <form id="login">
      <input type="text" id="user-name"><br>
      <input type="password" id="password"><br>
      <button onclick="login()">Login</button>
    </form>
  


  <script src="assets/js/password-generator.js"></script>
  <script src="assets/js/md5-js.js"></script>
  <script src="assets/js/aes-js.js"></script>
  <script src="assets/js/main.js"></script>

  <script>
    const server = window.location.href;
    function login() {
      event.preventDefault();
      console.log("Logging in");
      let userName = document.getElementById("user-name").value
      let password = document.getElementById("password").value
      console.log("User Name:", userName);
      console.log("Password:", password);
      let loginInfo = {
        username: userName,
        password: password
      }
      if (userName === "" || password === ""){
        console.log("Username or Password can not be blank");
      } else {
        let loginInfoStringified = JSON.stringify(loginInfo);
        let loginInfoEncoded = btoa(loginInfoStringified);
        const URL = server + 'api/login';
        $.post(URL, loginInfoEncoded, function (data, status) {
          // console.log("Passed data:", data.jwToken);
          if(data.jwToken === "Not Authenticated"){
            console.log("Login Failed");
            
          } else {
            console.log("Login Successfull")
            localStorage.setItem('JWT', JSON.stringify(data.jwToken));
          }
        })
      }
      document.getElementById("user-name").value = ""
      document.getElementById("password").value = ""
    }
  </script>
</body>

</html>